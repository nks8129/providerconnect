"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[210],{92210:function(e,t,s){s.r(t),s.d(t,{useCasesStore:function(){return u}});var a=s(3011),d=s(89134),i=s(88854),r=s(93448),n=s(16980),l=s(35729);let c={search:"",status:[],priority:[],category:[],subcategory:[],lob:[],assignee:[],team:[],channel:[],slaState:[],dateRange:{start:null,end:null}},o=[{id:"view_my_queue",name:"My Queue",filters:{},sortBy:"updatedAt",sortOrder:"desc",isDefault:!0,createdBy:"system"},{id:"view_unassigned",name:"Unassigned",filters:{assignee:["unassigned"]},sortBy:"createdAt",sortOrder:"asc",isDefault:!1,createdBy:"system"},{id:"view_breaching",name:"Breaching SLA",filters:{slaState:["breached","at_risk"]},sortBy:"updatedAt",sortOrder:"asc",isDefault:!1,createdBy:"system"}],u=(0,a.U)()((0,d.tJ)((e,t)=>({cases:[],isHydrated:!1,currentFilters:c,savedViews:o,selectedCaseId:null,setHydrated:()=>e({isHydrated:!0}),setCases:t=>e({cases:t}),addCase:t=>{var s;let a=new Date().toISOString(),d={...t,id:(0,r.VN)(),createdAt:a,updatedAt:a};e(e=>({cases:[d,...e.cases]}));let i=l.qr.getState();return i.addAuditEvent({id:(0,r.Ox)("audit"),entityType:"case",entityId:d.id,action:"created",actorId:(null===(s=i.currentUser)||void 0===s?void 0:s.id)||"system",timestamp:a,metadata:{category:d.category,priority:d.priority},description:"Case created: ".concat(d.title)}),d},updateCase:(t,s)=>{let a=new Date().toISOString();e(e=>({cases:e.cases.map(e=>e.id===t?{...e,...s,updatedAt:a}:e)}))},deleteCase:t=>{e(e=>({cases:e.cases.filter(e=>e.id!==t),selectedCaseId:e.selectedCaseId===t?null:e.selectedCaseId}))},getCase:e=>t().cases.find(t=>t.id===e),getCasesByProvider:e=>t().cases.filter(t=>t.providerId===e),getCasesByAssignee:e=>t().cases.filter(t=>t.assigneeId===e),getCasesByStatus:e=>t().cases.filter(t=>t.status===e),getOpenCases:()=>t().cases.filter(e=>"resolved"!==e.status&&"closed"!==e.status),getFilteredCases:e=>{let s={...t().currentFilters,...e},a=t().cases;if(s.search){let e=s.search.toLowerCase();a=a.filter(t=>t.id.toLowerCase().includes(e)||t.title.toLowerCase().includes(e)||t.summary.toLowerCase().includes(e))}return s.status.length>0&&(a=a.filter(e=>s.status.includes(e.status))),s.priority.length>0&&(a=a.filter(e=>s.priority.includes(e.priority))),s.category.length>0&&(a=a.filter(e=>s.category.includes(e.category))),s.subcategory.length>0&&(a=a.filter(e=>s.subcategory.includes(e.subcategory))),s.lob.length>0&&(a=a.filter(e=>s.lob.includes(e.lob))),s.assignee.length>0&&(a=s.assignee.includes("unassigned")?a.filter(e=>!e.assigneeId):a.filter(e=>e.assigneeId&&s.assignee.includes(e.assigneeId))),s.team.length>0&&(a=a.filter(e=>s.team.includes(e.teamId))),s.channel.length>0&&(a=a.filter(e=>s.channel.includes(e.channel))),s.slaState.length>0&&(a=a.filter(e=>{let t=(0,n.Gg)(e);return s.slaState.includes(t)})),s.dateRange.start&&(a=a.filter(e=>new Date(e.createdAt)>=new Date(s.dateRange.start))),s.dateRange.end&&(a=a.filter(e=>new Date(e.createdAt)<=new Date(s.dateRange.end))),a},assignCase:(s,a)=>{var d,i;let n=new Date().toISOString(),c=t().getCase(s),o=null==c?void 0:c.assigneeId;e(e=>({cases:e.cases.map(e=>e.id===s?{...e,assigneeId:a,status:"open"===e.status?"in_progress":e.status,updatedAt:n}:e)}));let u=l.qr.getState();u.addAuditEvent({id:(0,r.Ox)("audit"),entityType:"case",entityId:s,action:o?"reassigned":"assigned",actorId:(null===(d=u.currentUser)||void 0===d?void 0:d.id)||"system",timestamp:n,metadata:{assigneeId:a,previousAssignee:o},description:"Case ".concat(o?"reassigned":"assigned"," to ").concat((null===(i=u.getUser(a))||void 0===i?void 0:i.name)||"team member")})},updateStatus:(s,a)=>{var d;let i=new Date().toISOString(),n=t().getCase(s),c=null==n?void 0:n.status;e(e=>({cases:e.cases.map(e=>e.id===s?{...e,status:a,updatedAt:i}:e)}));let o=l.qr.getState();o.addAuditEvent({id:(0,r.Ox)("audit"),entityType:"case",entityId:s,action:"status_changed",actorId:(null===(d=o.currentUser)||void 0===d?void 0:d.id)||"system",timestamp:i,metadata:{status:a,previousStatus:c},description:"Status changed from ".concat(c," to ").concat(a)})},updatePriority:(s,a)=>{var d;let i=new Date().toISOString(),c=t().getCase(s);if(!c)return;let o=(0,n.Vk)(c.createdAt,a);e(e=>({cases:e.cases.map(e=>e.id===s?{...e,priority:a,sla:{...e.sla,dueAt:o},updatedAt:i}:e)}));let u=l.qr.getState();u.addAuditEvent({id:(0,r.Ox)("audit"),entityType:"case",entityId:s,action:"priority_changed",actorId:(null===(d=u.currentUser)||void 0===d?void 0:d.id)||"system",timestamp:i,metadata:{priority:a,previousPriority:c.priority},description:"Priority changed to ".concat(a)})},pauseSLA:(t,s)=>{var a;let d=new Date().toISOString();e(e=>({cases:e.cases.map(e=>e.id===t?{...e,status:"pending_provider",sla:{...e.sla,pausedAt:d,pauseReason:s},updatedAt:d}:e)}));let i=l.qr.getState();i.addAuditEvent({id:(0,r.Ox)("audit"),entityType:"case",entityId:t,action:"sla_paused",actorId:(null===(a=i.currentUser)||void 0===a?void 0:a.id)||"system",timestamp:d,metadata:{reason:s},description:"SLA paused: ".concat(s)})},resumeSLA:s=>{var a;let d=new Date().toISOString(),i=t().getCase(s);if(!i||!i.sla.pausedAt)return;let n=new Date(d).getTime()-new Date(i.sla.pausedAt).getTime(),c=new Date(new Date(i.sla.dueAt).getTime()+n).toISOString();e(e=>({cases:e.cases.map(e=>e.id===s?{...e,status:"in_progress",sla:{...e.sla,pausedAt:null,pauseReason:null,dueAt:c,totalPausedTime:(e.sla.totalPausedTime||0)+n},updatedAt:d}:e)}));let o=l.qr.getState();o.addAuditEvent({id:(0,r.Ox)("audit"),entityType:"case",entityId:s,action:"sla_resumed",actorId:(null===(a=o.currentUser)||void 0===a?void 0:a.id)||"system",timestamp:d,metadata:{newDueAt:c},description:"SLA resumed"})},resolveCase:(t,s)=>{var a;let d=new Date().toISOString(),i=l.qr.getState();e(e=>({cases:e.cases.map(e=>{var a;return e.id===t?{...e,status:"resolved",resolution:{...s,resolvedAt:d,resolvedBy:(null===(a=i.currentUser)||void 0===a?void 0:a.id)||null},updatedAt:d}:e})})),i.addAuditEvent({id:(0,r.Ox)("audit"),entityType:"case",entityId:t,action:"resolved",actorId:(null===(a=i.currentUser)||void 0===a?void 0:a.id)||"system",timestamp:d,metadata:{disposition:s.disposition,rootCause:s.rootCause},description:"Case resolved"})},addTask:(t,s)=>{var a;let d=new Date().toISOString(),i={id:(0,r.Ox)("task"),title:s,completed:!1,completedAt:null,completedBy:null,createdAt:d};e(e=>({cases:e.cases.map(e=>e.id===t?{...e,tasks:[...e.tasks,i],updatedAt:d}:e)}));let n=l.qr.getState();n.addAuditEvent({id:(0,r.Ox)("audit"),entityType:"case",entityId:t,action:"task_added",actorId:(null===(a=n.currentUser)||void 0===a?void 0:a.id)||"system",timestamp:d,metadata:{taskId:i.id,title:s},description:"Task added: ".concat(s)})},completeTask:(t,s)=>{var a;let d=new Date().toISOString(),i=l.qr.getState();e(e=>({cases:e.cases.map(e=>e.id===t?{...e,tasks:e.tasks.map(e=>{var t;return e.id===s?{...e,completed:!0,completedAt:d,completedBy:(null===(t=i.currentUser)||void 0===t?void 0:t.id)||null}:e}),updatedAt:d}:e)})),i.addAuditEvent({id:(0,r.Ox)("audit"),entityType:"case",entityId:t,action:"task_completed",actorId:(null===(a=i.currentUser)||void 0===a?void 0:a.id)||"system",timestamp:d,metadata:{taskId:s},description:"Task completed"})},deleteTask:(t,s)=>{let a=new Date().toISOString();e(e=>({cases:e.cases.map(e=>e.id===t?{...e,tasks:e.tasks.filter(e=>e.id!==s),updatedAt:a}:e)}))},addTag:(t,s)=>{let a=new Date().toISOString();e(e=>({cases:e.cases.map(e=>e.id!==t||e.tags.includes(s)?e:{...e,tags:[...e.tags,s],updatedAt:a})}))},removeTag:(t,s)=>{let a=new Date().toISOString();e(e=>({cases:e.cases.map(e=>e.id===t?{...e,tags:e.tags.filter(e=>e!==s),updatedAt:a}:e)}))},setFilters:t=>e(e=>({currentFilters:{...e.currentFilters,...t}})),clearFilters:()=>e({currentFilters:c}),selectCase:t=>e({selectedCaseId:t}),saveView:t=>{let s={...t,id:(0,r.Ox)("view")};e(e=>({savedViews:[...e.savedViews,s]}))},deleteView:t=>e(e=>({savedViews:e.savedViews.filter(e=>e.id!==t)})),getStats:()=>{let e=t().cases,s=e.filter(e=>"resolved"!==e.status&&"closed"!==e.status);return{total:e.length,open:e.filter(e=>"open"===e.status).length,inProgress:e.filter(e=>"in_progress"===e.status).length,pendingProvider:e.filter(e=>"pending_provider"===e.status).length,resolved:e.filter(e=>"resolved"===e.status||"closed"===e.status).length,breached:s.filter(e=>"breached"===(0,n.Gg)(e)).length,atRisk:s.filter(e=>"at_risk"===(0,n.Gg)(e)).length,unassigned:s.filter(e=>!e.assigneeId).length}}}),{name:i.I.CASES,onRehydrateStorage:()=>e=>{null==e||e.setHydrated()}}))}}]);